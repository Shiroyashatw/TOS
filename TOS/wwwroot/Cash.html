<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>註冊</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css">

    <link rel="stylesheet" href="css/style.css">

</head>

<body>



    <form id="formWebATM" method="post" accept-charset="UTF-8"
        action="https://payment-stage.opay.tw/Cashier/AioCheckOut/V5">

        MerchantID 商店代號: string (10)  測試用鎖死 => 2000132
        <input type="text" name="MerchantID" value="2000132" /><br />
        MerchantTradeNo 商店交易編號: string (20)
        <input type="text" name="MerchantTradeNo" value="DX2023012623342255Vt" /><br />
        MerchantTradeDate 商店交易時間: string (20) 格式:2023/01/26 23:34:22
        <input type="text" name="MerchantTradeDate" value="2023/01/26 23:34:22" /><br />
        PaymentType 交易類型: string (20) 鎖死
        <input type="text" name="PaymentType" value="aio" /><br />
        TotalAmount 交易金額: int
        <input type="text" name="TotalAmount" value="9" /><br />
        TradeDesc 交易描述: string (200)
        <input type="text" name="TradeDesc" value="建立全金流測試訂單" /><br />
        ItemName 商品名稱: string (200)
        <input type="text" name="ItemName" value="MacBook 30元X2#iPhone6s 40元X1" /><br />
        ReturnURL 付款完成通知回傳網址: string (200)
        <input type="text" name="ReturnURL" value="https://developers.opay.tw/AioMock/MerchantReturnUrl" /><br />
        ChoosePayment 預設付款方式: string (20) ALL 全部開放
        <input type="text" name="ChoosePayment" value="ALL" /><br />
        會員商店代碼: string (20) 選填
        <input type="text" name="StoreID" value="" /><br />
        ChooseSubPayment 預設子付款方式: string (20) 選填
        <input type="text" name="ChooseSubPayment" value="" /><br />
        ClientBackURL Client端返回廠商網址: string (200) 選填
        <input type="text" name="ClientBackURL"
            value="https://developers.opay.tw/AioMock/MerchantClientBackUrl" /><br />
        CheckMacValue 簽章類型: int 鎖死 1 => 模擬付款
        <input type="text" name="EncryptType" value="1" /><br />
        CheckMacValue 檢查碼: string (max) 鎖死
        <input type="text" name="CheckMacValue"
            value="06C58B74FE047DBEE5A24F04E9F025906F287EF21C99F29D60F7AEAF84F14679" /><br />
        <input type="submit" value="送出訂單" />

    </form>
    <div class="cash">
        <input type="hidden" id="HashKey" value="pwFHCqoQZGmho4w6" />
        <input type="hidden" id="HashIV" value="EkRm7iFT261dpevs" />
        <form id="cashform" action="https://payment-stage.ecpay.com.tw/Cashier/AioCheckOut/V5" method="post">
            <label for="">MerchantID<input type="hidden" name="MerchantID" value="3002607"></label>
            <br />
            <label for="">MerchantTradeNo<input type="text" name="MerchantTradeNo" value="DX20230127114112152C"></label>
            <br />
            <label for="">MerchantTradeDate<input type="hidden" name="MerchantTradeDate"
                    value="2023/01/27 11:41:12"></label>
            <br />
            <label for="">PaymentType<input type="hidden" name="PaymentType" value="aio"></label>
            <br />
            <label for="">TotalAmount <input type="hidden" name="TotalAmount" value="1000"></label>
            <br />
            <label for="">TradeDesc<input type="hidden" name="TradeDesc" value="美甲"></label>
            <br />
            <label for="">ItemName<input type="hidden" name="ItemName" value="繽紛"></label>
            <br />
            <label for="">ReturnURL<input type="hidden" name="ReturnURL"
                    value="https://hoyo.idv.tw/?a=Tools/EcPay&b=ReturnURL"></label>
            <br />
            <!-- <label for="">OrderResultURL<input type="text" id="" name="OrderResultURL" value="api/User"></label>
        <br /> -->
            <label for="">ChoosePayment<input type="hidden" id="" name="ChoosePayment" value="Credit"></label>
            <br />
            <label for="">CheckMacValue<input type="hidden" id="" name="CheckMacValue" value=""></label>
            <br />
            <label for="">EncryptType<input type="hidden" id="" name="EncryptType" value="1"></label>
            <br />
            <button type="button" id="btnSend">送出</button>

        </form>
    </div>


    <script>
        $('#btnSend').on('click', function () {

            let HashKey = "HashKey=pwFHCqoQZGmho4w6"
            let HashIV = "EkRm7iFT261dpevs"
            let itemName = $('input[name="ItemName"]').val();
            let MerchantTradeDate = $('input[name="MerchantTradeDate"]').val();
            let MerchantTradeNo = $('input[name="MerchantTradeNo"]').val();

            let returnUrl = $('input[name="ReturnURL"]').val();

            // let OrderResultURL = $('input[name="OrderResultURL"]').val();

            let TotalAmount = $('input[name="TotalAmount"]').val();
            let TradeDesc = $('input[name="TradeDesc"]').val();

            let x = `${HashKey}&ChoosePayment=Credit&EncryptType=1&ItemName=${itemName}&MerchantID=3002607&MerchantTradeDate=${MerchantTradeDate}&MerchantTradeNo=${MerchantTradeNo}&PaymentType=aio&ReturnURL=${returnUrl}&TotalAmount=${TotalAmount}&TradeDesc=${TradeDesc}&HashIV=${HashIV}`

            let y = encodeURIComponent(x)
            y = y.replace("%20", "+")
            y = y.toLowerCase();

            var hash = CryptoJS.SHA256(y).toString();

            hash = hash.toUpperCase()
            $('input[name="CheckMacValue"]').val(hash)

            $('#cashform').submit();
            // axios({
            //     method: "post",
            //     url: "https://payment-stage.ecpay.com.tw/Cashier/AioCheckOut/V5",
            //     data: {
            //         MerchantID: $('input[name="MerchantID"]').val()
            //     }
            // }).then(
            //     res => {
            //         console.log(res)
            //     }
            // ).catch((error) => console.log(error))
        })




        // let z = "HashKey%3dpwFHCqoQZGmho4w6%26ChoosePayment%3dCredit%26EncryptType%3d1%26ItemName%3d%e7%b9%bd%e7%b4%9b%26MerchantID%3d3002607%26MerchantTradeDate%3d2023%2f01%2f27+11%3a41%3a12%26MerchantTradeNo%3dDX20230127114112152a%26PaymentType%3daio%26ReturnURL%3dhttps%3a%2f%2fhoyo.idv.tw%2f%3fa%3dTools%2fEcPay%26b%3dReturnURL%26TotalAmount%3d1000%26TradeDesc%3d%e7%be%8e%e7%94%b2%26HashIV%3dEkRm7iFT261dpevs";
        // %20 應該轉換成 +


    </script>
</body>

</html>